FROM maven:3.9.9-eclipse-temurin-21 AS backend

WORKDIR /app

# Wrapper Maven
COPY ./backend/.mvn/ .mvn/
COPY ./backend/mvnw ./
RUN chmod +x mvnw

# POMs
COPY pom.xml ./
COPY ./backend/pom.xml ./backend/
COPY ./shared_common/pom.xml ./shared_common/

# Pré-télécharger les dépendances
RUN ./mvnw -pl backend -am dependency:go-offline -B

# Copier le code source
COPY ./backend/src /app/backend/src
COPY ./shared_common/src /app/shared_common/src

# Démarrage
CMD ["./mvnw", "-pl", "backend", "-am", "spring-boot:run", "-DskipTests"]
